/*! BUILD: 2021-12-06 */
CoinSeller=Spine.Controller.sub({ejsPath:{input:"templates/coinInput.ejs",confirm:"templates/coinConfirm.ejs",success:"templates/coinSuccess.ejs",query:"templates/coinQuery.ejs",queryDetail:"templates/coinQueryDetail.ejs",branchesMain:"templates/branchesMain.ejs",branchesList:"templates/branchesList.ejs",tips:"templates/tips.ejs",coinTab:"templates/coinTab.ejs",coinInformation:"templates/coinInformation.ejs",blackTips:"templates/blackProTips.ejs",inforMain:"templates/informationMain.ejs",inforQuery:"templates/informationQuery.ejs",modifyCountIpt:"templates/modifyCountInput.ejs",modifyNameIpt:"templates/modifyNameInput.ejs",cancelCfm:"templates/cancelConfirm.ejs",cancelScs:"templates/cancelSuccess.ejs",imagTips:"templates/imagTips.ejs",coinInform:"templates/coinInform.ejs",privacyProtocal:"templates/privacyProtocal.ejs",noCoin:"templates/noCoin.ejs"},events:{"click #branch_List .chBranch":"branchChoose"},init:function(){var a=this;Common.LightBox.show(),a.coinList={},a["switch"]="",a.smsLock="",a.smsAppLock="",a.qSurvLock="",a.branchHash=new Common.Hashtable,a.el.html(a.ejsPath.coinTab,function(){a.nodeEjsId={reserveMain:a.el.find("#load_main_ejs"),queryMain:a.el.find("#load_query_ejs"),inforMain:a.el.find("#load_information_ejs")},a.getCoinInfo(),a.el.find("li.tabs").on("click",function(){return $(this).hasClass("tabs-current")?!1:($(this).addClass("tabs-current").siblings().removeClass("tabs-current"),Common.LightBox.show(),a.nodeEjsId.reserveMain.children().remove(),a.nodeEjsId.queryMain.children().remove(),a.nodeEjsId.inforMain.children().remove(),a[this.id](),void Common.LightBox.hide())})})},publicInfoQuery:function(){var a=this,b=a.nodeEjsId.inforMain;b.siblings().hide(),Common.getCurrentTime(function(c){"TRUE"==c["switch"]?a.getProductList(function(d,e){b.html(a.ejsPath.inforMain,{},function(){var f=b.find("#sel_province_0708"),g=b.find("#sel_city_0708"),h=b.find("#sel_county_0708"),i=[],j=null;$.each(d,function(a,b){j=e[b.key],j.pubStartDate&&j.pubEndDate?CU.Date.diff(j.pubStartDate,c.sysDate)>=0&&CU.Date.diff(c.sysDate,j.pubEndDate)>=0&&i.push(b):j.pubStartDate?CU.Date.diff(j.pubStartDate,c.sysDate)>=0&&i.push(b):j.pubEndDate?CU.Date.diff(c.sysDate,j.pubEndDate)>=0&&i.push(b):i.push(b)}),a.loadItselect("productId",i,b.find("#sel_info_product"),!1,null,function(c){a.chooseProduct(c,b,f,g,h),a.loadItselect("city",[],g),a.loadItselect("county",[],h)}),a.loadItselect("province",[],f),a.loadItselect("city",[],g),a.loadItselect("county",[],h),CU.changeLan(b.show()),Common.LightBox.hide(),0==i.length&&a.showLineMessage({message:"l0014"})})}):a.showLineMessage({message:"l0001"})})},chooseProduct:function(a,b,c,d,e){var f=this,g=[],h=b.find("#open_information"),i=b.find("#info_pager_foot"),j=b.find("#researchDiv"),k=b.find("#infoQueryShow");Common.LightBox.show(),Common.requestInterface(new Model("PsnCoinPubInfoQuery",{productId:a,queryType:"0"}),function(i){var l=i.ctrDate||"--";b.find("#infoUpdateTime").text(l),g=[{key:"",val:"<span>请选择</span>"}],$.each(i.pubInfoDetail,function(a,b){g.push({key:b.sectionSeg,val:"<span>"+b.sectionSeg+"</span>"})}),f.loadHtml(h,i,function(){k.show(),j.hide(),f.loadItselect("province",g,c,!1,null,function(c){""==c?(j.hide().find("input[type='text']").val(""),Common.LightBox.show(),f.loadHtml(h,i),f.loadItselect("city",[],d)):(j.show(),f.chooseProvince({queryType:"1",productId:a,province:c},h,d,e,b)),f.loadItselect("county",[],e)})})},function(){k.hide(),i.hide(),h.empty(),Common.LightBox.hide(),f.loadItselect("province",[],c),f.loadItselect("city",[],d),f.loadItselect("county",[],e)})},chooseProvince:function(a,b,c,d,e){var f=this;Common.LightBox.show(),Common.requestInterface(new Model("PsnCoinPubInfoQuery",a),function(a){var g=a.ctrDate||"--";e.find("#infoUpdateTime").text(g),f.loadNetWorkInfoList(a,"city",c,b,function(){f.loadItselect("county",[],d)},function(a){f.loadNetWorkInfoList(a,"county",d,b)})})},bindQuery:function(a,b,c){var d=this,e=null,f=d.el.find("#InfoSearchName"),g=d.el.find("#btn_branch_search_name");g.off("click").on("click",function(){var g=f.val().trim(),h=[];e=$.extend({},a),g==f.attr("placeholder")&&(g=""),Common.LightBox.show(),""==g?d.loadHtml(c,b):($.each(e.pubInfoDetail,function(a,b){-1!=b.bankName.indexOf(g)&&(b.sectionSeg=b.bankName,h[h.length]=b)}),e.pubInfoDetail=h,e.showFlag=!0,d.loadHtml(c,e))}),f.on("keydown",function(a){var b=CU.getKeyCode(a);13==b&&g.trigger("click")})},loadHtml:function(a,b,c){var d=this,e=d.ejsPath.inforQuery,f=$.extend({},b);f.pubInfoDetail=f.pubInfoDetail.slice(0,10),a.html(e,f,function(){d.paging(e,a,"#info_pager_foot",b,1),a.show(),Common.LightBox.hide(),c&&c(b)})},loadNetWorkInfoList:function(a,b,c,d,e,f){var g=this,h=$.extend({},a),i=[{key:"",val:"<span>请选择</span>"}],j=!1,k={};$.each(h.pubInfoDetail,function(a,c){j=!0,$.each(i,function(a,d){c[b]==d.key&&(j=!1,k[c[b]].pubInfoDetail.push(c),k[c[b]].allNum=Number(k[c[b]].allNum)+Number(c.allNum),k[c[b]].onlineNum=Number(k[c[b]].onlineNum)+Number(c.onlineNum),k[c[b]].outlineNum=Number(k[c[b]].outlineNum)+Number(c.outlineNum),k[c[b]].onlineUnNum=Number(k[c[b]].onlineUnNum)+Number(c.onlineUnNum),k[c[b]].outlineUnNum=Number(k[c[b]].outlineUnNum)+Number(c.outlineUnNum),k[c[b]].selledNum=Number(k[c[b]].selledNum)+Number(c.selledNum))}),j&&(i.push({key:c[b],val:"<span>"+c[b]+"</span>"}),k[c[b]]={sectionSeg:c[b],allNum:c.allNum,onlineNum:c.onlineNum,outlineNum:c.outlineNum,onlineUnNum:c.onlineUnNum,outlineUnNum:c.outlineUnNum,selledNum:c.selledNum,pubInfoDetail:[c]})}),h.pubInfoDetail=[],$.each(i,function(a,b){b.key&&(k[b.key].sectionSeg=b.key,h.pubInfoDetail.push(k[b.key]),k[b.key].section=k[b.key].sectionSeg,k[b.key].allSum=k[b.key].allNum,k[b.key].onlineSum=k[b.key].onlineNum,k[b.key].outlineSum=k[b.key].outlineNum,k[b.key].onlineUnSum=k[b.key].onlineUnNum,k[b.key].outlineUnSum=k[b.key].outlineUnNum,k[b.key].selledSum=k[b.key].selledNum)}),g.loadHtml(d,h,function(){g.bindQuery(a,h,d),g.loadItselect(b,i,c,!1,null,function(c){Common.LightBox.show(),""==c?(g.loadHtml(d,h),g.bindQuery(a,h,d),e&&e()):"county"==b?(k[c].showFlag=!0,g.loadHtml(d,k[c]),g.bindQuery(k[c],k[c],d)):f&&f(k[c])})})},getCoinInfo:function(){sysDate="",sysTime="";var a=this,b=a.nodeEjsId.reserveMain;data={method:"",params:""},b.siblings().hide(),$.ajax({url:"/ocas-web/BaseInfoForOcas/product.json?random="+Math.random(),type:"get",showLoading:!0,data:"json="+encodeURIComponent(JSON.stringify(data).replace(/"null"/g,'""')),dataType:"json",contentType:"application/x-www-form-urlencoded; charset=UTF-8",cache:!1,error:function(){Common.LightBox.hide(),Common.LightBox.showMessage(Common.Error.getMsgByCode("ajaxError"))},success:function(a,b){var c=new Date(b.xhr.getResponseHeader("Date")),d=c.getFullYear();month=c.getMonth()+1,date=c.getDate(),hours=c.getHours(),minutes=c.getMinutes(),seconds=c.getSeconds(),10>month&&(month="0"+month),10>date&&(date="0"+date),10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes),10>seconds&&(seconds="0"+seconds),sysDate=d+"/"+month+"/"+date,sysTime=hours+""+minutes+seconds}}).then(function(c){c&&c.list&&c.list.length>0?(a.coinList=c,a.getCoinData(c.list,sysDate,sysTime)):(b.html(a.ejsPath.noCoin),CU.changeLan(b),b.show(),Common.LightBox.hide())})},reserveInput:function(a,b,c){var d=this,e=d.nodeEjsId.reserveMain,f={identyType:"01",maxNum:"0"};b&&(a.provinceList=b),d.chooseProductInfo=a,e.siblings().hide(),e.html(d.ejsPath.input,{smsAppLock:d.smsAppLock,proInfo:d.chooseProductInfo},function(){var a=e.find("#txt_identitynumber_1956717"),b=e.find("#customer_information"),g=e.find("#btn_nextstep_1956722"),h=e.find("#btn_change__1383915");d.loadCustormInformation($.extend(f,d.chooseProductInfo),b,g,h),d.addInputValid("01",a,!1),a.on("blur",function(b){return formValid.addBlurcheck(a,b)?void(this.value=this.value.toUpperCase()):!1}),c&&(e.find("input").val("").removeClass("passed warning").removeAttr("pass"),d.identyType_itSelect.reset(),f.identyType="01",d.addInputValid("01",a,!1),f.count=f.maxNum,d.resetBranch()),e.find("#btn_reset_1956723").on("click",function(){d.getCoinInfo()}),e.find("#date-picker").on("click",function(){d.showLineMessage({message:"l0025"})}),CU.changeLan(e),e.show();var i=e.find("#txt_captcha_79449");d.addVerCode(e,i),d.initInputSms(e,f),d.addProtocal(e)})},loadBlackProTips:function(a,b){var c=this,d=null;a.blacklistFlag&&"1"==a.blacklistFlag?(d={checkSDateFormat:c.formatDate(a.checkStartDate),checkEDateFormat:c.formatDate(a.checkEndDate)},Common.LightBox.show(),c.el.append(c.ejsPath.blackTips,d,function(){var a=c.el.find("#black_tips_1128");CU.setObjAbsCenter(a),CU.changeLan(a),a.find("#btn_Confirm_20191128").on("click",function(){a.remove(),Common.LightBox.hide(),b()}),a.find("a.close,#btn_cancel_20191128").on("click",function(){a.remove(),Common.LightBox.hide()})})):b()},loadCustormInformation:function(a,b,c,d){var e=this;Common.LightBox.show(),$.extend(a,{flag:!0,formatStartTime:e.formatTime(a.startTime),formatEndTime:e.formatTime(a.endTime)}),e.userInfo?(e.el.find("#txt_name_1956714").val(e.userInfo.userName),e.el.find("#txt_mobile_1956715").val(e.userInfo.mobileNum),e.el.find("#txt_identitynumber_1956717").val(e.userInfo.identyNumber)):e.userInfo={},e.el.find("#txt_name_1956714").bind("input propertychange",function(){e.userInfo.userName=e.el.find("#txt_name_1956714").val()}),e.el.find("#txt_mobile_1956715").bind("input propertychange",function(){e.userInfo.mobileNum=e.el.find("#txt_mobile_1956715").val()}),e.el.find("#txt_identitynumber_1956717").bind("input propertychange",function(){e.userInfo.identyNumber=e.el.find("#txt_identitynumber_1956717").val()}),e.resetBranch(),e.loadMaxCountItselect(e.el.find("#sel_93844_1956719"),a),e.el.find("#sel_93844_1956719").val(a.maxNum),e.el.find("#cost_money").text(e.caclAmount(a.maxNum,a.parValue)),CU.changeLan(b),Common.LightBox.hide(),e.nextBtnStatus="0",c.off("click").on("click",function(){function b(b){function c(){if("TRUE"==b["switch"])if(CU.Date.diff(a.startDate,b.sysDate)<0||0===CU.Date.diff(a.startDate,b.sysDate)&&b.sysTime<currentProvinces.firstDayStartTime)e.showLineMessage({message:"l0004"});else if(CU.Date.diff(a.endDate,b.sysDate)>0||0===CU.Date.diff(a.endDate,b.sysDate)&&b.sysTime>a.endTime)e.showLineMessage({message:"l0008"});else if(b.sysTime<a.startTime&&b.sysTime>a.endTime)e.showLineMessage({message:"l0004"});else{var c=$.extend(a,b);e.reserveSuccess(e.nodeEjsId.reserveMain.find("#input_main"),c)}else e.showLineMessage({message:"l0001"})}b=b||e.timeObj;var d=e.smsAppLock;e["switch"]=b["switch"],e.smsLock=b.smsLock,e.smsAppLock=b.smsAppLock,e.qSurvLock=b.qSurvLock,"TRUE"==d&&"FALSE"==e.smsAppLock?e.showLineMessage({message:"l0027"},function(){e.nodeEjsId.reserveMain.find("#input_main").find("#a_11_79447").trigger("click"),Common.LightBox.hide(),e.el.find("#phoneInputPart")&&e.el.find("#phoneInputPart").hide()}):c()}if(!formValid.checkAll(e.el))return e.orgParams||(e.el.find("#dept_name").addClass("warning"),e.showLineMessage({message:"l0002"},function(){e.chooseBranches(a)})),!1;if(e.orgParams){if(e.nodeEjsId.reserveMain.find("#has_checked").hasClass("hide"))return e.showLineMessage({message:"l0023"}),!1;if(e.el.find("#no_date").hasClass("hide")&&""===e.el.find("#date-picker").val())return e.showLineMessage({message:"l0026"}),!1;"0"===e.nextBtnStatus?Common.getCurrentTime(function(a){e.nextBtnStatus="1",e.timeObj=a,b(a)}):b()}else e.showLineMessage({message:"l0002"},function(){e.chooseBranches(a)})}).removeClass("btn-red-disabled"),d.off("click").on("click",function(){e.chooseBranches(a)})},checkIdentyNumber:function(a,b){var c,d=this,e=a.substring(6,10),f=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1],g=[1,0,"X",9,8,7,6,5,4,3,2],h=0;a=a.split("");for(var i=0;17>i;i++)h+=f[i]*a[i];c=g[h%11];var j=b.substring(0,4);return a[17]!=c||1900>e||e>Number(j)?(d.showLineMessage({message:"l0010"}),!0):!1},reserveSuccess:function(a,b){var c=this,d=$.extend({name:a.find("#txt_name_1956714").val().trim(),count:a.find("#sel_93844_1956719").val(),identyNumber:a.find("#txt_identitynumber_1956717").val().trim(),mobile:a.find("#txt_mobile_1956715").val(),validationChar:"TRUE"===c.smsAppLock?"":a.find("#txt_captcha_79449").val(),smsValidCode:"TRUE"===c.smsAppLock?a.find("#txt_phonechar").val():"",cexDate:a.find("#no_date").hasClass("hide")?a.find("#date-picker").val().replace(/\//g,""):"00000000",terminalId:c.getUrlParam("type","outlink")?"99":"15"},b,c.orgParams);if("01"==d.identyType&&c.checkIdentyNumber(d.identyNumber,d.sysDate))return!1;var e={};$.each(["identyType","identyNumber","name","mobile","productId","proNum","count","validationChar","bankId","bankName","address","bankmobile","productName","orgProvID","orgL1branchID","orgCityID","province","proVersion","briefName","smsValidCode","cexDate","partnerFlag","terminalId"],function(a,b){e[b]=d[b]}),e.channel="01",Common.LightBox.show(),Common.request(new Model("PsnCoinApply",e),function(){d.qSurvLock=c.qSurvLock,d.amount=c.caclAmount(d.count,d.parValue),d.cexDateFormat=c.formatDateCom(d.cexDate,"1"),d.sellStartDateFormat=c.formatDateCom(d.sellStartDate,"1"),d.sellEndDateFormat=c.formatDateCom(d.sellEndDate,"1");var e=c.nodeEjsId.reserveMain.find("#success_main");e.html(c.ejsPath.success,d,function(){if(c.orgParams=null,c.userInfo=null,c.el.find("#btn_reserve_672121").on("click",function(){c.getCoinInfo()}),"TRUE"==b.qSurvLock&&"1"==b.description&&b.proNum){var d=c.getUrlPath();d=d+"/BOCQS/question.html?proId="+encodeURI(b.proNum),c.el.find("#btn_question_survey").attr("href",d)}a.empty().hide(),e.show(),Common.LightBox.hide()})},function(b){Common.LightBox.hide(),("smsLock.is.noOpen"===b.code||"FALSE"===c.smsLock)&&(c.smsAppLock="FALSE",c.el.find("#phoneInputPart")&&c.el.find("#phoneInputPart").hide()),a.find("#a_11_79447").trigger("click")})},reserveQuery:function(a){var b=this,c=b.nodeEjsId.queryMain,d=b.coinList.list;if(c.siblings().hide(),Common.LightBox.show(),d&&d.length>0){for(var b=this,e=[],f={},g=0;g<d.length;g++)d[g].checkSDateFormat=b.formatDate(d[g].checkStartDate),e.push({key:d[g].productId,val:"<span>"+d[g].productName+"</span>"}),f[d[g].productId]=d[g];b.createQurey(e,f,a)}else b.getProductList(function(c,d){b.createQurey(c,d,a)})},createQurey:function(a,b){var c=this,d={identyType:"01"},e=c.nodeEjsId.queryMain;e.html(c.ejsPath.query,{},function(){var f=e.find("#txt_identitynumber_1956669"),g=e.find("#txt_name_1956667"),h=e.find("#btn_49_1956670");c.loadItselect("productId",a,e.find("#sel_coinQ_product"),!0,a[0],function(a){$.extend(d,b[a])}),f.on("blur",function(a){return formValid.addBlurcheck(f,a)?void(this.value=this.value.toUpperCase()):!1}),Common.LightBox.hide(),CU.changeLan(e.show()),0==a.length&&c.showLineMessage({message:"l0014"}),a.length>0&&(c.productId_itSelect.setValue(a[0].key),$.extend(d,a[0].key)),h.on("click",function(){if(0==a.length)return c.showLineMessage({message:"l0014"}),!1;if(d.productId){if(!formValid.checkAll(e))return!1;d.identyNumber=f.val().trim(),d.name=g.val().trim(),c.queryList(d,e)}else c.showLineMessage({message:"l0012"})})})},queryList:function(a,b){var c=this,d=b.find("#query_information_show"),e={productId:a.productId,identyType:a.identyType,identyNumber:a.identyNumber,name:a.name};d.children().remove(),Common.getCurrentTime(function(f){if("TRUE"==f["switch"]){if("01"==a.identyType&&c.checkIdentyNumber(a.identyNumber,f.sysDate))return!1;Common.LightBox.show(),Common.requestInterface(new Model("PsnApplyInfoQuery",e),function(g){g=$.extend({},a,g),"00000000"===g.sellStartDate&&(g.sellStartDate=""),"00000000"===g.sellEndDate&&(g.sellEndDate=""),"00000000"===g.cexDate&&(g.cexDate=""),g.sellStartDateFormat=c.formatDateCom(g.sellStartDate,"1"),g.sellEndDateFormat=c.formatDateCom(g.sellEndDate,"1"),g.cexDateFormat=c.formatDateCom(g.cexDate,"1"),g.endTimeFlag=a.endDate?CU.Date.diff(f.sysDate,a.endDate)>=0:!0,g.sellEndFlag=g.sellEndDate?CU.Date.diff(f.sysDate,c.formatDateCom(g.sellEndDate,"2"))>=0:!0,g.smsLock=f.smsLock,g.amount=c.caclAmount(g.count,g.parValue),d.html(c.ejsPath.queryDetail,g,function(){var h=b.find("#queryMain"),i=b.find("#changeInformation"),j=d.find("#btn_modifystep_0706"),k=d.find("#btn_cancel_0706"),l=d.find("#btn_modifyname_0706");g.endTimeFlag&&(j.on("click",function(){f.sysTime>a.startTime&&f.sysTime<a.endTime?c.modifyCountInput($.extend({},g),h,i,e):c.showLineMessage({message:"l0017",startTime:c.formatTime(a.startTime),endTime:c.formatTime(a.endTime)})}),k.on("click",function(){f.sysTime>a.startTime&&f.sysTime<a.endTime?c.showLineMessage({message:"l0016",flag:!0,tipsTitle:"l0022"},function(){c.cancelConfirm(g,h,i,e)}):c.showLineMessage({message:"l0018",startTime:c.formatTime(a.startTime),endTime:c.formatTime(a.endTime)})})),g.sellEndFlag&&l.on("click",function(){g.modNameNum&&g.modNameNum<3?c.showLineMessage({message:"l0020",flag:!0},function(){c.modifyNameInput($.extend({},g),h,i,e)}):c.showLineMessage({message:"l0019"})}),CU.changeLan(d.show()),Common.LightBox.hide()})})}else{var g=function(){b.find("#txt_identitynumber_1956669").val(""),b.find("#txt_name_1956667").val("")};c.showLineMessage({message:"l0001"},g,null,null,g)}})},cancelConfirm:function(a,b,c,d){var e=this;Common.LightBox.show(),c.html(e.ejsPath.cancelCfm,a,function(){var f=c.find("#cancel_confirm_page"),g=f.find("#txt_inputdealcode_18055"),h=f.find("#txt_captcha_79449");c.find("#btn_cancel1_0706").on("click",function(){f.remove(),c.hide(),b.show()}),c.find("#btn_cancel_confirm_0706").on("click",function(){return formValid.checkAll(c)?void e.cancelSuccess(a,c,g.val(),d):!1}),e.addVerCode(f,h),e.getdealcode(a,f,d),b.hide(),CU.changeLan(c.show()),Common.LightBox.hide()})},cancelSuccess:function(a,b,c,d){var e=this;Common.LightBox.show(),Common.requestInterface(new Model("PsnCoinApplCancl",{identyType:"01",identyNumber:d.identyNumber,name:d.name,productId:a.productId,smsValidCode:c,terminalId:e.getUrlParam("type","outlink")?"99":"15"}),function(){b.html(e.ejsPath.cancelScs,{},function(){b.next().hide(),b.find("#btn_cancel_back_0706").on("click",function(){Common.LightBox.show(),e.el.find("#getCoinInfo").trigger("click"),Common.LightBox.hide()}),Common.LightBox.hide()})})},modifyCountInput:function(a,b,c,d){var e=this,f=a.count,g=a.maxNum,h=a.parValue;Common.LightBox.show(),c.html(e.ejsPath.modifyCountIpt,a,function(){var i=c.find("#modify_count_page"),j=i.find("#txt_captcha_79449"),k=i.find("#txt_inputdealcode_18055");countModifyId=c.find("#txt_count_modify"),countModifyId.val(f),countModifyId.attr("max",g),c.find("#count_modify_up").on("click",function(){f=parseInt(countModifyId.val()),g>f&&(f+=1,countModifyId.val(f+"")),c.find("#amount_sec").text(e.caclAmount(f,h))}),c.find("#count_modify_down").on("click",function(){f=parseInt(countModifyId.val()),f>1&&(f-=1,countModifyId.val(f+"")),c.find("#amount_sec").text(e.caclAmount(f,h))}),countModifyId.bind("input propertychange",function(){f=parseInt(countModifyId.val()),f>=1&&g>=f?c.find("#amount_sec").text(e.caclAmount(f,h)):f>g?(countModifyId.val(g+""),c.find("#amount_sec").text(e.caclAmount(g,h))):1>f?(countModifyId.val("1"),c.find("#amount_sec").text(e.caclAmount(1,h))):(countModifyId.val("1"),c.find("#amount_sec").text(e.caclAmount(1,h)))}),e.addVerCode(i,j),e.getdealcode(a,i,d),c.find("#btn_modify_confirm_0706").on("click",function(){if(f==parseInt(a.count))e.showLineMessage({message:"l0015"});else{if(!formValid.checkAll(c))return!1;var g=countModifyId.val();e.modifySuccess(a,b,c,d,k.val(),"",g,i)}}),c.find("#btn_modify_cancel_0706").on("click",function(){i.remove(),c.hide(),b.show()}),b.hide(),CU.changeLan(c.show()),Common.LightBox.hide()})},modifyNameInput:function(a,b,c,d){var e=this;Common.LightBox.show(),c.html(e.ejsPath.modifyNameIpt,a,function(){var f=c.find("#modify_name_page"),g=f.find("#txt_inputdealcode_18055"),h=f.find("#txt_captcha_79449");c.find("#txt_name_modify").val(d.name),e.addVerCode(f,h),e.getdealcode(a,f,d),c.find("#btn_modify_confirm_0706").on("click",function(){if(c.find("#txt_name_modify").val().trim()==d.name)e.showLineMessage({message:"l0015"});else{if(!formValid.checkAll(c))return!1;var h=c.find("#txt_name_modify").val();e.modifySuccess(a,b,c,d,g.val(),h,"",f)}}),c.find("#btn_modify_cancel_0706").on("click",function(){f.remove(),c.hide(),b.show()}),b.hide(),CU.changeLan(c.show()),Common.LightBox.hide()})},modifySuccess:function(a,b,c,d,e,f,g,h){var i=this;Common.LightBox.show(),Common.requestInterface(new Model("PsnCoinModify",{identyType:"01",identyNumber:d.identyNumber,name:d.name,productId:a.productId,count:g,nameMod:f,smsValidCode:e}),function(){Common.LightBox.hide();var a=function(){f&&b.find("#txt_name_1956667").val(f),i.nodeEjsId.queryMain.find("#queryMain").show().find("#btn_49_1956670").trigger("click"),h.remove(),c.hide(),b.show()};i.showLineMessage({message:"l0021"},a,null,null,a)})},getdealcode:function(a,b,c){var d=this,e=b.find("#btn_getdealcode_18056"),f=b.find("#code_cd"),g=b.find("#code_sec"),h=null,i=60;e.on("click",function(){var j=b.find("#txt_captcha_79449");return CU.setObjAbsCenter(b),CU.changeLan(b),formValid.checkAll(b.find(".code"))?(Common.LightBox.show(),void Common.request(new Model("PsnCoinConfirmSms",{identyType:"01",identyNumber:c.identyNumber,name:c.name,productId:a.productId,validationChar:j.val()}),function(){i=60,f.show(),e.hide(),g.text(i),h&&clearInterval(h),h=setInterval(function(){i--,0>=i?(e.show(),f.hide()):g.size()>0&&g.text(i)},1e3),Common.LightBox.hide()},function(){b.find("#a_11_79447").trigger("click"),Common.LightBox.hide()})):(d.showLineMessage({message:"l0003"},function(){j.val("").get(0).focus()}),!1)})},chooseBranches:function(a){var b=this,c=[],d=[];Common.LightBox.show(),$.each(a.provinceList,function(a,b){for(var e=0;e<proList.length;e++)if(proList[e].provinceCode===b.orgL1branchID){d.push(proList[e]),c.push({key:proList[e].provinceCode,val:"<span>"+proList[e].provinceName+"</span>"});break}}),b.el.append(b.ejsPath.branchesMain,{},function(){var e=b.el.find("#choose_branch"),f=b.el.find("#branch_List"),g=b.ejsPath.branchesList,h=[],i=!1,j=function(a,c){a=a||[],c=c||!1,f.html(g,{list:a.slice(0,10),flag:c},function(){b.paging(g,f,"#pager_foot",a,1)})},k=b.el.find("#btn_branch_name"),l=b.el.find("#txtSearchName");k.on("click",function(){if(""==b.province_itSelect.val)return b.showLineMessage({message:"l0028"}),!1;if(""==b.city_itSelect.val)return b.showLineMessage({message:"l0029"}),!1;var a=l.val().trim(),c=[];a==l.attr("placeholder")&&(a=""),""==a?j(h,i):($.each(h,function(b,d){-1!=d.bankName.indexOf(a)&&(c[c.length]=d)}),j(c))}),l.on("keydown",function(a){var b=CU.getKeyCode(a);13==b&&k.trigger("click")}),b.loadItselect("province",c,e.find("#sel_province"),!1,null,function(c){var f=[];Common.LightBox.show();var g={method:"",params:""};$.ajax({url:"/ocas-web/BaseOrgInfoForOcas/"+a.productId+"_"+c+"_branch.json?random="+Math.random(),type:"get",showLoading:!0,data:"json="+encodeURIComponent(JSON.stringify(g).replace(/"null"/g,'""')),dataType:"json",contentType:"application/x-www-form-urlencoded; charset=UTF-8",error:function(){Common.LightBox.hide(),Common.LightBox.showMessage(Common.Error.getMsgByCode("ajaxError"))},success:function(){Common.LightBox.hide()}}).then(function(a){a&&a.list&&a.list.length>0&&(f=a.list)});for(var i=[],k={},l=0;l<d.length;l++)if(d[l].provinceCode===c){k=d[l];for(var m=0;m<k.cityList.length;m++)i.push({key:k.cityList[m].cityCode,val:k.cityList[m].cityName});break}b.loadItselect("city",i,e.find("#sel_city"),!1,null,function(c){Common.LightBox.show(),b.getNetWorkList({productId:a.productId,orgCityID:c,bankId:""},function(a){Common.LightBox.hide(),h=[];for(var c=0;c<a.list.length;c++)for(var d=a.list[c],g=0;g<f.length;g++)if(f[g].bankId===d.bankId){h.push($.extend(f[g],d));break}j(h);var i=[{key:"",val:"<span>请选择</span>"}],k={};$.each(h,function(a,c){b.branchHash.add(c.bankId,c);var d=!0;$.each(i,function(a,b){c.county==b.key&&(d=!1,k[c.county].push(c))}),d&&(i.push({key:c.county,val:"<span>"+c.county+"</span>"}),k[c.county]=[],k[c.county].push(c))}),b.loadItselect("county",i,e.find("#sel_county_0826"),!1,null,function(b){h=k[b]||a,j(h)})})})}),b.loadItselect("city",[],e.find("#sel_city")),b.loadItselect("county",[],e.find("#sel_county_0826")),e.find("#btn_close_6830,a.close").on("click",function(){e.remove(),Common.LightBox.hide()}),CU.changeLan(e),CU.setObjAbsCenter(e.show())})},branchChoose:function(a){var b=this;b.orgParams=b.branchHash.item($(a).attr("bankId")),b.el.find("#dept_name").removeClass("warning"),b.el.find("#dept_name").val(b.orgParams.bankName),b.el.find("#dept_addr").text(b.orgParams.address),b.el.find("#emptyPart").hide(),b.el.find("#dept_mobile").text(b.orgParams.bankmobile),b.el.find("#chooseBranches").show(),b.el.find("#date-picker").off("click");var c=!0;if(b.orgParams.sellStartDate&&"00000000"!=b.orgParams.sellStartDate&&b.orgParams.sellEndDate&&"00000000"!=b.orgParams.sellEndDate){var d=b.formatDateCom(b.orgParams.sellStartDate,"2"),e=b.formatDateCom(b.orgParams.sellEndDate,"2");b.el.find("#date-picker").datepicker({dateFormat:"%Y/%m/%d",fromDate:d,toDate:e,selectedDate:{year:new Date(d).getFullYear(),month:new Date(d).getMonth()+1,day:new Date(d).getDate()}})}else b.el.find("#date-picker").hide(),b.el.find("#no_date").show(),c=!1;c&&(b.el.find("#date-picker").show(),b.el.find("#no_date").hide()),b.el.find("#btn_change__1383915").text("修改"),b.el.find("#choose_branch").remove(),Common.LightBox.hide()},getNetWorkList:function(a,b){Common.requestInterface(new Model("PsnCityInstitution",a),function(a){b&&b(a)})},getProductList:function(a){var b=this,c=[],d={};Common.requestInterface(new Model("PsnProductInfoQuery"),function(e){$.each(e.list,function(a,e){e.checkSDateFormat=b.formatDate(e.checkStartDate),c.push({key:e.productId,val:"<span>"+e.productName+"</span>"}),d[e.productId]=e}),a&&a(c,d)})},formatDate:function(a){var b="";if(a)try{b=a.replace(/(.+?)\-(.+?)\-(.+)/,"$1年$2月$3日")}catch(c){b=""}return b},formatDateCom:function(a,b){var c="";return a&&"00000000"!=a?("1"==b&&(c=a.replace(/^(\d{4})(\d{2})(\d{2})$/,"$1-$2-$3")),"2"==b&&(c=a.replace(/^(\d{4})(\d{2})(\d{2})$/,"$1/$2/$3"))):c="",c},addVerCode:function(a,b){var c=function(){a.find("#captcha").attr("src",validationURL+(new Date).getTime()+".gif")};c(),a.find("#a_11_79447,#captcha").on("click",function(a){stopBubble(a||window.event),b.val("").removeClass("warning"),setTimeout(function(){c()},1)}),$.browser.msie?b.on("focus",function(){$(this).removeClass("inputfm")}).on("blur",function(){var a=$.trim($(this).val());(""===a||a===CU.getDictNameByKey("l7143"))&&$(this).addClass("inputfm")}):b.removeClass("inputfm")},loadMaxCountItselect:function(a,b){var c=this,d=parseInt(b.maxNum,10);a.attr("max",d),a.removeAttr("readonly"),a.bind("input propertychange",function(){Number(a.val())<1?a.val(1):Number(a.val())>d&&a.val(d),c.el.find("#cost_money").text(c.caclAmount(a.val(),b.parValue)),b.count=a.val()}),c.nodeEjsId.reserveMain.find("#count_input_up").on("click",function(){var e=parseInt(a.val());d>e&&(e+=1,c.nodeEjsId.reserveMain.find("#sel_93844_1956719").val(e),c.el.find("#cost_money").text(c.caclAmount(e,b.parValue)),b.count=a.val())}),c.nodeEjsId.reserveMain.find("#count_input_down").on("click",function(){var d=parseInt(a.val());d>1&&(d-=1,c.nodeEjsId.reserveMain.find("#sel_93844_1956719").val(d),c.el.find("#cost_money").text(c.caclAmount(d,b.parValue)),b.count=a.val())})},bindTypeItselect:function(a,b,c){this.loadItselect("identyType",[{key:"01",val:"身份证"}],a,!0,b,c)},resetBranch:function(){var a=this;a.orgParams=null,a.el.find("#chooseBranches").hide(),a.el.find("#btn_change__1383915").find("span").text("选择")},loadItselect:function(a,b,c,d,e,f){b&&0==b.length&&(d=!1),this[a+"_itSelect"]=new ITSelect({data:b,appendTo:c.empty(),defValue:d?b[0].key:"",defText:d?b[0].val:"<span>请选择</span>",oddCls:"even",callback:function(b){e&&(e[a]=b.val),f&&f(b.val)}})},addInputValid:function(a,b,c){Common.LightBox.show(),b.attr("01"==a?{tips:"tipsmax tipsmin tips0265",validateGroup:"{required:true,reg55:true,maxLength:18,minLength:18}",maxLength:"18"}:{tips:"tipsrequired tips0267 tipsmax",validateGroup:"{required:true,maxLength:18,reg58:true}",maxLength:"18"}),c&&b.val("").removeClass("warning").get(0).focus(),Common.LightBox.hide()},showLineMessage:function(a,b,c,d,e){var f=this;a.flag=a.flag||!1,a.trueButtonContent=c||!1,a.falseButtonContent=d||!1,Common.LightBox.show(),f.el.append(f.ejsPath.tips,a,function(){var a=f.el.find("#pop_tips_0917");CU.setObjAbsCenter(a),CU.changeLan(a),a.find("#btn_Confirm").on("click",function(){a.remove(),Common.LightBox.hide(),b&&b()}),a.find(".close").on("click",function(){a.remove(),Common.LightBox.hide(),e&&e()}),a.find("#btn_cancel").on("click",function(){a.remove(),Common.LightBox.hide()})})},paging:function(a,b,c,d,e){var f=this,g=10,h={},i=null;i=$.isArray(d)?d.length:d.pubInfoDetail.length;var j={canvas:c,callbackFn:function(e){$.isArray(d)?h.list=d.slice((e-1)*g,e*g):(h=$.extend({},d),h.pubInfoDetail=h.pubInfoDetail.slice((e-1)*g,e*g)),b.html(a,h,function(){f.paging(a,b,c,d,e)})},pageIndex:e,point:f,recordCount:i,pageSize:g,showDownload:!1},k=Pager.getInstance();k.init(j),$(c)[i>0?"show":"hide"]()},formatTime:function(a){return isNaN(a)||a&&"6"!=a.length?a:/(\d{2})(\d{2})(\d{2})/.exec(a).slice(1).join(":")},getUrlPath:function(){var a="https://survey.cmcoins.boc.cn";if(window.location.host.includes("22.87")||window.location.host.includes("22.86")||window.location.host.includes("22.184"))var a="https://22.188.138.67";return a},getCoinData:function(a,b,c){for(var d=this,e=0;e<a.length;e++){provinceList=a[e].provinceList,newProvinceList=[];for(var f=[],g=0;g<provinceList.length;g++)f.push(provinceList[g].bankStartTime);for(var h={},i=[],j=0;j<f.length;j++)h[f[j]]||(h[f[j]]=!0,i.push(f[j]));i.sort();for(var k=0;k<i.length;k++)newProvinceList[k]=new Array;for(var l=0;l<provinceList.length;l++)for(var m=0;m<i.length;m++)provinceList[l].bankStartTime===i[m]&&(newProvinceList[m].push(provinceList[l]),newProvinceList[m].firstDayStartTime=d.formatTime(provinceList[l].bankStartTime));for(var n=0;n<newProvinceList.length;n++){var o="";newProvinceList[n].firstDayStartTime=newProvinceList[n][0].bankStartTime,newProvinceList[n].formatFirstDayStartTime=d.formatTime(newProvinceList[n][0].bankStartTime).substring(0,5);for(var p=0;p<newProvinceList[n].length;p++){for(var q=0;q<proList.length;q++)proList[q].provinceCode===newProvinceList[n][p].orgL1branchID&&(o=o+proList[q].provinceName+"、");newProvinceList[n].provinceStr=o.slice(0,-1)}}a[e].newProvinceList=newProvinceList}for(var r=0;r<a.length;r++){var s=a[r];formatStartTime=s.startTime?d.formatTime(s.startTime):"00:00:00",formatEndTime=s.endTime?d.formatTime(s.endTime):"23:59:59",s.checkStartDate=s.checkStartDate?s.checkStartDate.replace(/\//g,"-"):"",s.checkEndDate=s.checkEndDate?s.checkEndDate.replace(/\//g,"-"):"",s.startDate=s.startDate?s.startDate.replace(/\//g,"-"):"",s.endDate=s.endDate?s.endDate.replace(/\//g,"-"):"",s.parValue=s.parValue?s.parValue:"",d.judgeTime(s,b,c)}d.showCoinInfo(a)},showCoinInfo:function(a){var b=this,c=b.nodeEjsId.reserveMain;c.siblings().hide(),c.html(b.ejsPath.coinInform,{list:a},function(){var d=c.find(".btn_apply");d.each(function(){$(this).addClass(0===$(this).data("status")||2===$(this).data("status")?"btn-disabled-0":"btn-disabled-1")}),c.find(".btn_apply").on("click",function(){product=a[$(this).data("index")],currentProvinces=product.newProvinceList[$(this).data("id")],"1"==currentProvinces.apply_btn_status&&Common.getCurrentTime(function(a){b["switch"]=a["switch"],b.smsLock=a.smsLock,b.smsAppLock=a.smsAppLock,b.qSurvLock=a.qSurvLock,"TRUE"==a["switch"]?CU.Date.diff(product.startDate,a.sysDate)<0||0===CU.Date.diff(product.startDate,a.sysDate)&&a.sysTime<currentProvinces.firstDayStartTime?b.showLineMessage({message:"l0004"}):CU.Date.diff(product.endDate,a.sysDate)>0||0===CU.Date.diff(product.endDate,a.sysDate)&&a.sysTime>product.endTime?b.showLineMessage({message:"l0008"}):a.sysTime<product.startDate&&a.sysTime>product.endDate?b.showLineMessage({message:"l0004"}):b.loadBlackProTips(product,function(){product.sysDate=a.sysDate,b.reserveInput(product,currentProvinces)
}):b.showLineMessage({message:"l0001"})})})}),CU.changeLan(c),c.show(),Common.LightBox.hide()},getUrlParam:function(a,b){var c=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),d=window.location.search.substr(1).match(c);return userType=null!=d?d[2]:"",userType===b?!0:!1},initInputSms:function(a,b){var c=this,d=a.find("#get-sms-input"),e=a.find("#sms_count_down"),f=a.find("#sms_count_down_num"),g=a.find("#txt_phonechar"),h=null,i=60,j=a.find("#txt_captcha_79449");a.find("#get-sms-input").on("click",function(){if(!formValid.checkAll(c.el.find("#mobile-input")))return!1;if("01"==b.identyType&&c.checkIdentyNumber(a.find("#txt_identitynumber_1956717").val(),b.sysDate))return!1;if(!a.find("#txt_captcha_79449").val())return c.showLineMessage({message:"l0003"}),!1;Common.LightBox.show();var k={identyType:b.identyType,identyNumber:a.find("#txt_identitynumber_1956717").val(),productId:b.productId,mobile:a.find("#txt_mobile_1956715").val(),validationChar:j.val()};Common.request({models:[new Model("PsnCoinApplyfirmSms",k)],success:function(){Common.LightBox.hide(),g.val("").removeClass("warning"),i=60,e.show(),d.hide(),f.text(i),h&&clearInterval(h),h=setInterval(function(){i--,0>=i?(d.show(),e.hide()):f.size()>0&&f.text(i)},1e3)},fail:function(b){Common.LightBox.hide(),"smsLock.is.noOpen"===b.code?(c.showLineMessage({message:"l0027"}),c.smsAppLock="FALSE",c.el.find("#phoneInputPart")&&c.el.find("#phoneInputPart").hide()):Common.handleError(b),a.find("#a_11_79447").trigger("click")},dataHandle:!1})})},addProtocal:function(a){var b=!1,c=this;a.find("#protocal_checkbox, #has_checked").on("click",function(){b=!b,b?(a.find("#protocal_checkbox").hide(),a.find("#has_checked").show()):(a.find("#protocal_checkbox").show(),a.find("#has_checked").hide())}),a.find("#jump_protocal").on("click",function(){c.nodeEjsId.reserveMain.find("#protocal_main").html(c.ejsPath.privacyProtocal,function(){c.nodeEjsId.reserveMain.find("#protocal_main").show(),c.nodeEjsId.reserveMain.find("#input_main").hide(),c.nodeEjsId.reserveMain.find("#protocal-back").on("click",function(){c.nodeEjsId.reserveMain.find("#protocal_main").hide(),c.nodeEjsId.reserveMain.find("#input_main").show()})})})},judgeTime:function(a,b,c){for(var d=0;d<a.newProvinceList.length;d++){var e=a.newProvinceList[d];CU.Date.diff(a.startDate,b)<0||0===CU.Date.diff(a.startDate,b)&&c<e.bankStartTime?(a.newProvinceList[d].apply_btn_status="0",a.newProvinceList[d].apply_btn_name="即将开始"):CU.Date.diff(a.endDate,b)>0||0===CU.Date.diff(a.endDate,b)&&c>a.endTime?(a.newProvinceList[d].apply_btn_status="2",a.newProvinceList[d].apply_btn_name="预约结束"):c<a.startTime&&c>a.endTime?(a.newProvinceList[d].apply_btn_status="0",a.newProvinceList[d].apply_btn_name="即将开始"):(a.newProvinceList[d].apply_btn_status="1",a.newProvinceList[d].apply_btn_name="立即预约")}},caclAmount:function(a,b){return b?(parseInt(a)*Math.round(100*b)*.01).toFixed(2):" — "}});